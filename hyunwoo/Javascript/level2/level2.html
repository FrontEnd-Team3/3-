<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script defer type="module" src="./level2.js"></script>
    <title>예약 고객 확인하기</title>
  </head>
  <body>
    <form onsubmit="checkReservation(); return false">
      <p>이름: <input name="user-name" /></p>
      <p>연락처: <input name="user-phone" maxlength="13" /></p>
      <button>예약번호 확인</button>
    </form>
    <p id="reservation-number"></p>
  </body>
  <script>
    const RESERVATION_LIST = [
      {
        name: "김성용",
        phone: "010-1234-1234",
        number: "1234-1234-1234",
      },
      {
        name: "김사과",
        phone: "010-1111-1111",
        number: "1111-1111-1111",
      },
      {
        name: "김성용",
        phone: "010-2222-2222",
        number: "2222-2222-2222",
      },
      {
        name: "이멜론",
        phone: "010-3333-3333",
        number: "3333-3333-3333",
      },
      {
        name: "오랜지",
        phone: "010-4444-4444",
        number: "4444-4444-4444",
      },
      {
        name: "박수박",
        phone: "010-5555-5555",
        number: "5555-5555-5555",
      },
      {
        name: "박수박",
        phone: "010-6666-6666",
        number: "6666-6666-6666",
      },
      {
        name: "김성용",
        phone: "010-7777-7777",
        number: "7777-7777-7777",
      },
      {
        name: "오랜지",
        phone: "010-8888-8888",
        number: "8888-8888-8888",
      },
      {
        name: "김성용",
        phone: "010-9999-9999",
        number: "9999-9999-9999",
      },
      {
        name: "반하나",
        phone: "010-0000-0000",
        number: "0000-0000-0000",
      },
    ];
    const $addressInput = document.querySelector("input[name='user-phone']");
    const $nameInput = document.querySelector("input[name='user-name']");
    const $reservationNumber = document.getElementById("reservation-number");
    const checkReservation = function () {
      const reservation = RESERVATION_LIST.filter(
        (reservation) =>
          reservation.name === $nameInput.value &&
          reservation.phone === $addressInput.value
      );
      if (reservation.length === 0) {
        $reservationNumber.innerText = null;
        return alert("일치하는 고객이 없습니다.");
      }
      $reservationNumber.innerText = reservation[0].number;
    };
    $addressInput.addEventListener("input", () => {
      let phoneAddress;
      phoneAddress = $addressInput.value = $addressInput.value.replace(
        /[^0-9]/g,
        ""
      );
      phoneAddress = phoneAddress.replaceAll("-", "");

      if (4 <= phoneAddress.length && phoneAddress.length < 8) {
        $addressInput.value =
          phoneAddress.slice(0, 3) + "-" + phoneAddress.slice(3);
      }
      if (phoneAddress.length >= 8) {
        $addressInput.value =
          phoneAddress.slice(0, 3) +
          "-" +
          phoneAddress.slice(3, 7) +
          "-" +
          phoneAddress.slice(7);
      }
    });
  </script>
</html>
